<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Menu ç®¡ç†å¾Œå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .menu-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }

        .menu-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .menu-content {
            padding: 20px;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .menu-region {
            display: inline-block;
            padding: 6px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .menu-id {
            font-family: monospace;
            font-size: 11px;
            color: #999;
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 5px;
        }

        .menu-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .menu-info {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #666;
        }

        .menu-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-success:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .default-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #FFD700;
            color: #333;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.5);
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #ff4444;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
        }

        .alias-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            margin-top: 30px;
        }

        .alias-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .alias-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .alias-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .alias-id {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .alias-target {
            font-size: 12px;
            color: #666;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›ï¸ Rich Menu ç®¡ç†å¾Œå°</h1>
            <p class="subtitle">LINE Bot Rich Menu æ§åˆ¶é¢æ¿</p>
        </header>

        <div id="error-container"></div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-menus">-</div>
                <div class="stat-label">ç¸½é¸å–®æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-aliases">-</div>
                <div class="stat-label">Alias æ•¸é‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="default-region">-</div>
                <div class="stat-label">é è¨­åœ°å€</div>
            </div>
        </div>

        <div id="loading" class="loading">
            è¼‰å…¥ä¸­...
        </div>

        <div id="menu-container" class="menu-grid" style="display: none;">
            <!-- Rich Menu cards will be inserted here -->
        </div>

        <div class="alias-section" style="display: none;" id="alias-section">
            <h2>ğŸ“ Rich Menu Aliases</h2>
            <div id="alias-container" class="alias-list">
                <!-- Aliases will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        let defaultMenuId = null;
        const regionNames = {
            'north': 'åŒ—éƒ¨',
            'central': 'ä¸­éƒ¨',
            'south': 'å—éƒ¨',
            'east': 'æ±éƒ¨',
            'islands': 'é›¢å³¶'
        };

        async function loadRichMenus() {
            try {
                const response = await fetch('/api/richmenus');
                const result = await response.json();

                if (result.success) {
                    displayRichMenus(result.data);
                    document.getElementById('total-menus').textContent = result.data.length;
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('è¼‰å…¥ Rich Menu å¤±æ•—: ' + error.message);
            }
        }

        async function loadDefaultMenu() {
            try {
                const response = await fetch('/api/richmenu/default');
                const result = await response.json();

                if (result.success) {
                    defaultMenuId = result.data.richMenuId;

                    // æ‰¾å‡ºå°æ‡‰çš„åœ°å€
                    const menus = document.querySelectorAll('.menu-card');
                    menus.forEach(card => {
                        const menuId = card.dataset.menuId;
                        if (menuId === defaultMenuId) {
                            const region = card.dataset.region;
                            document.getElementById('default-region').textContent = region || 'æœªçŸ¥';
                        }
                    });
                }
            } catch (error) {
                console.error('è¼‰å…¥é è¨­é¸å–®å¤±æ•—:', error);
            }
        }

        async function loadAliases() {
            try {
                const response = await fetch('/api/aliases');
                const result = await response.json();

                if (result.success) {
                    displayAliases(result.data);
                    document.getElementById('total-aliases').textContent = result.data.length;
                }
            } catch (error) {
                console.error('è¼‰å…¥ Alias å¤±æ•—:', error);
            }
        }

        function displayRichMenus(menus) {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            menus.forEach(menu => {
                const card = createMenuCard(menu);
                container.appendChild(card);
            });

            document.getElementById('loading').style.display = 'none';
            container.style.display = 'grid';
        }

        function createMenuCard(menu) {
            const card = document.createElement('div');
            card.className = 'menu-card';
            card.dataset.menuId = menu.richMenuId;
            card.dataset.region = menu.region;

            const isDefault = menu.richMenuId === defaultMenuId;

            card.innerHTML = `
                ${isDefault ? '<div class="default-badge">â­ é è¨­</div>' : ''}
                <img class="menu-image" src="/api/richmenu/${menu.richMenuId}/image" alt="${menu.name}">
                <div class="menu-content">
                    <div class="menu-header">
                        ${menu.region ? `<span class="menu-region">${menu.region}</span>` : ''}
                        <span class="menu-id">${menu.richMenuId.substring(0, 12)}...</span>
                    </div>
                    <div class="menu-name">${menu.name}</div>
                    <div class="menu-info">
                        <span>ğŸ“ ${menu.size.width}x${menu.size.height}</span>
                        <span>ğŸ’¬ ${menu.chatBarText}</span>
                    </div>
                    <div class="menu-actions">
                        ${!isDefault ? `<button class="btn btn-success" onclick="setDefault('${menu.richMenuId}')">è¨­ç‚ºé è¨­</button>` : ''}
                        <button class="btn btn-danger" onclick="deleteMenu('${menu.richMenuId}')">åˆªé™¤</button>
                    </div>
                </div>
            `;

            return card;
        }

        function displayAliases(aliases) {
            const container = document.getElementById('alias-container');
            const section = document.getElementById('alias-section');

            if (aliases.length > 0) {
                section.style.display = 'block';
                container.innerHTML = '';

                aliases.forEach(alias => {
                    const aliasCard = document.createElement('div');
                    aliasCard.className = 'alias-item';
                    aliasCard.innerHTML = `
                        <div class="alias-id">${alias.aliasId}</div>
                        <div class="alias-target">${alias.richMenuId.substring(0, 20)}...</div>
                    `;
                    container.appendChild(aliasCard);
                });
            }
        }

        async function setDefault(menuId) {
            if (!confirm('ç¢ºå®šè¦è¨­å®šæ­¤ Rich Menu ç‚ºé è¨­å—ï¼Ÿ')) return;

            try {
                const response = await fetch('/api/richmenu/default', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ richMenuId: menuId })
                });

                const result = await response.json();

                if (result.success) {
                    alert('è¨­å®šæˆåŠŸï¼');
                    location.reload();
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('è¨­å®šå¤±æ•—: ' + error.message);
            }
        }

        async function deleteMenu(menuId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ Rich Menu å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;

            try {
                const response = await fetch(`/api/richmenu/${menuId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('åˆªé™¤æˆåŠŸï¼');
                    location.reload();
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('åˆªé™¤å¤±æ•—: ' + error.message);
            }
        }

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="error">âŒ ${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // è¼‰å…¥è³‡æ–™
        async function init() {
            await loadRichMenus();
            await loadDefaultMenu();
            await loadAliases();
        }

        init();
    </script>
</body>
</html>
